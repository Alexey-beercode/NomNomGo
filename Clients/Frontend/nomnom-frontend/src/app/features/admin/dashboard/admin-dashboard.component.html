<!-- src/app/features/admin/dashboard/admin-dashboard.component.html -->

<div class="dashboard" *ngIf="!loading">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
      <p class="header-subtitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–Ω–µ–ª—å NomNomGo</p>
      <div class="header-meta">
        <span class="last-updated">{{ getLastUpdatedText() }}</span>
        <button class="refresh-btn" (click)="refreshData()" [disabled]="loading">
          <span class="refresh-icon" [class.spinning]="loading">üîÑ</span>
          –û–±–Ω–æ–≤–∏—Ç—å
        </button>
      </div>
    </div>
  </div>

  <!-- Stats Overview -->
  <div class="stats-section">
    <div class="stats-grid">
      <div class="stat-card revenue">
        <div class="stat-header">
          <div class="stat-icon">üí∞</div>
          <div class="stat-trend positive">
            <span class="trend-icon">üìà</span>
            +{{ stats.monthlyGrowth | number:'1.1-1' }}%
          </div>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatCurrency(stats.totalRevenue) }}</div>
          <div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
          <div class="stat-sublabel">–ó–∞ –≤—Å–µ –≤—Ä–µ–º—è</div>
        </div>
        <div class="stat-footer">
          <small>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: {{ formatCurrency(getAverageOrderValue()) }}</small>
        </div>
      </div>

      <div class="stat-card orders">
        <div class="stat-header">
          <div class="stat-icon">üìã</div>
          <div class="stat-badge">{{ stats.todayOrders }}</div>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(stats.totalOrders) }}</div>
          <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
          <div class="stat-sublabel">{{ stats.todayOrders }} —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div class="stat-footer">
          <small>–ó–∞–≤–µ—Ä—à–µ–Ω–æ: {{ getOrdersCompletionRate() | number:'1.0-0' }}%</small>
        </div>
      </div>

      <div class="stat-card restaurants">
        <div class="stat-header">
          <div class="stat-icon">üè™</div>
          <div class="stat-utilization">
            {{ getRestaurantUtilization() | number:'1.0-0' }}%
          </div>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(stats.totalRestaurants) }}</div>
          <div class="stat-label">–†–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤</div>
          <div class="stat-sublabel">{{ stats.activeRestaurants }} –∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
        </div>
        <div class="stat-footer">
          <small>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</small>
        </div>
      </div>

      <div class="stat-card users">
        <div class="stat-header">
          <div class="stat-icon">üë•</div>
          <div class="stat-trend positive">
            <span class="trend-icon">üìà</span>
            +15.2%
          </div>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(stats.totalUsers) }}</div>
          <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
          <div class="stat-sublabel">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ</div>
        </div>
        <div class="stat-footer">
          <small>–†–æ—Å—Ç –∑–∞ –º–µ—Å—è—Ü</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions-section">
    <div class="section-header">
      <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
      <p class="section-subtitle">–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</p>
    </div>

    <div class="actions-grid">
      <a *ngFor="let action of quickActions"
         [routerLink]="action.route"
         class="action-card"
         [class]="'action-' + action.color"
         [class.urgent]="action.urgent"
         (click)="navigateToSection(action.route)">

        <div class="action-header">
          <div class="action-icon" [class]="'icon-' + action.color">
            {{ action.icon }}
          </div>
          <div class="action-badge" *ngIf="action.badge && action.badge > 0">
            {{ action.badge }}
          </div>
        </div>

        <div class="action-content">
          <div class="action-title">{{ action.title }}</div>
          <div class="action-description">{{ action.description }}</div>
        </div>

        <div class="action-arrow">‚Üí</div>
      </a>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="content-grid">
    <!-- Recent Activity -->
    <div class="activity-section">
      <div class="section-header">
        <h2>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
        <a routerLink="/admin/activity" class="view-all-link">
          –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ
          <span class="link-arrow">‚Üí</span>
        </a>
      </div>

      <div class="activity-container">
        <div class="activity-list" *ngIf="recentActivities.length > 0; else noActivity">
          <div class="activity-item"
               *ngFor="let activity of recentActivities; trackBy: trackActivity"
               [class]="getActivityTypeClass(activity.type)">

            <div class="activity-icon">{{ activity.icon }}</div>

            <div class="activity-content">
              <div class="activity-text">{{ activity.text }}</div>
              <div class="activity-time">{{ activity.time }}</div>
            </div>

            <div class="activity-type">
              <span class="type-badge" [class]="'type-' + activity.type">
                {{ activity.type }}
              </span>
            </div>
          </div>
        </div>

        <ng-template #noActivity>
          <div class="empty-state">
            <div class="empty-icon">üìù</div>
            <p>–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Popular Restaurants -->
    <div class="restaurants-section">
      <div class="section-header">
        <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã</h2>
        <a routerLink="/admin/restaurants" class="view-all-link">
          –í—Å–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã
          <span class="link-arrow">‚Üí</span>
        </a>
      </div>

      <div class="restaurants-container">
        <div class="restaurant-list" *ngIf="popularRestaurants.length > 0; else noRestaurants">
          <div class="restaurant-item"
               *ngFor="let restaurant of popularRestaurants; let i = index; trackBy: trackRestaurant">

            <div class="restaurant-rank">
              <span class="rank-number" [class]="'rank-' + (i + 1)">{{ i + 1 }}</span>
            </div>

            <div class="restaurant-info">
              <div class="restaurant-name">{{ restaurant.name }}</div>
              <div class="restaurant-stats">
                <span class="rating">
                  <span class="star">‚≠ê</span>
                  {{ restaurant.rating | number:'1.1-1' }}
                </span>
                <span class="orders">{{ restaurant.orders }} –∑–∞–∫–∞–∑–æ–≤</span>
              </div>
            </div>

            <div class="restaurant-metrics">
              <div class="revenue">{{ formatCurrency(restaurant.revenue) }}</div>
              <div class="growth" [class]="getGrowthClass(restaurant.growth)">
                <span class="growth-icon">{{ getGrowthIcon(restaurant.growth) }}</span>
                <span class="growth-text">
                  {{ restaurant.growth > 0 ? '+' : '' }}{{ restaurant.growth | number:'1.1-1' }}%
                </span>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noRestaurants>
          <div class="empty-state">
            <div class="empty-icon">üè™</div>
            <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö</p>
            <a routerLink="/admin/restaurants" class="empty-action">
              –î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω
            </a>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats-section">
      <div class="section-header">
        <h2>–ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
      </div>

      <div class="quick-stats-grid">
        <div class="quick-stat">
          <div class="quick-stat-icon">‚è≥</div>
          <div class="quick-stat-content">
            <div class="quick-stat-value">{{ stats.pendingOrders }}</div>
            <div class="quick-stat-label">–û–∂–∏–¥–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏</div>
          </div>
        </div>

        <div class="quick-stat">
          <div class="quick-stat-icon">‚úÖ</div>
          <div class="quick-stat-content">
            <div class="quick-stat-value">{{ getOrdersCompletionRate() | number:'1.0-0' }}%</div>
            <div class="quick-stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤</div>
          </div>
        </div>

        <div class="quick-stat">
          <div class="quick-stat-icon">üí≥</div>
          <div class="quick-stat-content">
            <div class="quick-stat-value">{{ formatCurrency(getAverageOrderValue()) }}</div>
            <div class="quick-stat-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
          </div>
        </div>

        <div class="quick-stat">
          <div class="quick-stat-icon">üìä</div>
          <div class="quick-stat-content">
            <div class="quick-stat-value">{{ getRestaurantUtilization() | number:'1.0-0' }}%</div>
            <div class="quick-stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="loading">
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è...</h3>
    <p>–ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</p>
  </div>
</div>

<!-- Error State -->
<div class="error-state" *ngIf="error && !loading">
  <div class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
    <p>{{ error }}</p>
    <div class="error-actions">
      <button class="retry-btn" (click)="refreshData()">
        <span class="retry-icon">üîÑ</span>
        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
      </button>
      <button class="contact-btn">
        <span class="contact-icon">üìû</span>
        –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
      </button>
    </div>
  </div>
</div>
